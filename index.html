<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ミネラルバランス（レーダーチャート）</title>
  <style>
    html,body{height:100%;margin:0;background:#0b0b0b;color:#e8e8e8;font-family:system-ui,-apple-system,Segoe UI,Roboto,"ヒラギノ角ゴ ProN",Meiryo,sans-serif}
    .wrap{height:100%;display:flex;align-items:center;justify-content:center;padding:16px;box-sizing:border-box}
    .card{width:min(900px,100%);background:#141414;border:1px solid #2a2a2a;border-radius:16px;padding:16px 16px 8px}
    h1{font-size:16px;margin:0 0 8px;color:#bdbdbd;font-weight:600}
    #note{font-size:12px;color:#9aa0a6;margin-top:8px}
    canvas{width:100% !important;height:60vh !important;max-height:520px}
  </style>
  <!-- Chart.js CDN（Radar対応） -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <h1 id="title">ミネラルバランス</h1>
      <canvas id="chart"></canvas>
      <div id="note">オレンジ＝現在値 / グレー＝目標値</div>
    </div>
  </div>

  <script>
    // ===== URLパラメータで値を差し替え可能 =====
    // 例）...?ca=90&mg=45&k=95&p=100&s=60&goal=85&title=圃場A
    const q = new URLSearchParams(location.search);
    const num = (k, def) => {
      const v = parseFloat(q.get(k));
      return isFinite(v) ? v : def;
    };

    // 現在値（デフォルトの例値）
    const current = {
      ca: num('ca', 90),
      mg: num('mg', 45),
      k : num('k', 95),
      p : num('p', 100),
      s : num('s', 60),
    };
    // 目標値（1つの数で全指標に同じ値を入れる or 個別指定）
    const goal = {
      ca: num('goal_ca', num('goal', 85)),
      mg: num('goal_mg', num('goal', 85)),
      k : num('goal_k',  num('goal', 85)),
      p : num('goal_p',  num('goal', 85)),
      s : num('goal_s',  num('goal', 85)),
    };

    // タイトル
    const title = q.get('title');
    if (title) document.getElementById('title').textContent = `ミネラルバランス（${title}）`;

    const labels = ['Ca（カルシウム）','Mg（マグネシウム）','K（カリウム）','P（リン酸）','S（硫酸イオン）'];
    const currentData = [current.ca,current.mg,current.k,current.p,current.s];
    const goalData    = [goal.ca,goal.mg,goal.k,goal.p,goal.s];

    // レーダーチャート描画
    const ctx = document.getElementById('chart');
    new Chart(ctx, {
      type: 'radar',
      data: {
        labels,
        datasets: [
          {
            label: '現在値',
            data: currentData,
            borderColor: 'rgba(255,140,0,0.9)',
            backgroundColor: 'rgba(255,140,0,0.15)',
            pointBackgroundColor: 'rgba(255,140,0,1)',
            borderWidth: 2,
          },
          {
            label: '目標値',
            data: goalData,
            borderColor: 'rgba(200,200,200,0.9)',
            backgroundColor: 'rgba(200,200,200,0.10)',
            pointBackgroundColor: 'rgba(220,220,220,1)',
            borderWidth: 2,
          }
        ]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        scales: {
          r: {
            suggestedMin: 0,
            suggestedMax: 100,
            angleLines: { color: 'rgba(255,255,255,0.08)' },
            grid: { color: 'rgba(255,255,255,0.08)' },
            pointLabels: { color: '#d0d0d0', font: { size: 12 } },
            ticks: { showLabelBackdrop: false, color: '#9aa0a6', stepSize: 20 }
          }
        },
        plugins: {
          legend: { labels: { color: '#d0d0d0' } },
          tooltip: {
            callbacks: {
              label: (ctx) => `${ctx.dataset.label}: ${ctx.formattedValue} 点`
            }
          }
        }
      }
    });
  </script>
</body>
</html>
